---
title: "FAOSTAT"
author: "alex lin "
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output: html_document
---
<script>
function toggleCollapsible(section) {
  var content = section.nextElementSibling;
  if (content.style.display === "none") {
    content.style.display = "block";
  } else {
    content.style.display = "none";
  }
}
</script>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("../R_agricultural/read_data.R")  ## read data
source("../R_agricultural/data_wrangling.R")  ## data wrangling
```
<h1 onclick="toggleCollapsible(this);">
<!--TEXT SHOWS: -->
<b>Plot</b>
</h1>
<div style="display:none;">  

</div>
<h3 onclick="toggleCollapsible(this);">
<!--TEXT SHOWS: -->
<b>EDA Plot for each crop data</b>
</h3>
<div style="display:none;">  
```{r}

# Plotting the Value over Years for a specific Item, loop for all items
# change y aixs as unit is different for each Element Value
for (item in unique(data_fao$Item)) {
  plot <- ggplot(data = data_fao %>% filter(Item == item), aes(x = Year, y = Value, color = Element)) +
    geom_line() +
    labs(title = paste("Trends Over Time for", item), x = "Year", y = "Value")
  #print(plot)
  # Plotting the Value over Years for each Element (e.g., "Apples")
  options(repr.plot.width = 35, repr.plot.height = 8)  # Adjust width and height
  facet_plot <- ggplot(data = data_fao %>% filter(Item == item), aes(x = Year, y = Value)) +
    geom_line() +
    facet_wrap(~ Element, scales = "free_y") +
    labs(title = paste("Trends Over Time for", item), x = "Year", y = "Value") +
    theme_minimal()+
    scale_x_continuous(breaks = seq(min(data_fao$Year), max(data_fao$Year), by = 3))+
    theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))  # Rotate x-axis labels
# Change 'by' to your preferred interval

  print(facet_plot)
  }
```



```{r echo=FALSE, message=FALSE, warning=FALSE}
weekly_data_x <- aggregate_data(data_x)
```
</div>

<h3 onclick="toggleCollapsible(this);">
<!--TEXT SHOWS: -->
<b>linear reg for yield VS EHF 95</b>
</h3>
<div style="display:none;">  
</div>

<h4 onclick="toggleCollapsible(this);">
<!--TEXT SHOWS: -->
<b>Abbotsford</b>
</h4>
<div style="display:none;">  
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Example usage:
results <- perform_linear_regression(weekly_data_x, data_fao,"Abbotsford", "week_Mean_EHF_95")

unique_crops <- unique(data_fao$Item)
#Print results for each crop
for (crop in unique_crops) {
  print(paste("Results for crop:", crop))
  print(results[[crop]]$summary)
  if (!is.null(results[[crop]]$plot)) {
    print(results[[crop]]$plot)
  }
}

```


</div>
<h3 onclick="toggleCollapsible(this);">
<!--TEXT SHOWS: -->
<b>linear reg for yield VS daily Max Temp</b>
</h3>
<div style="display:none;">  
</div>

<h4 onclick="toggleCollapsible(this);">
<!--TEXT SHOWS: -->
<b>Abbotsford</b>
</h4>
<div style="display:none;">  
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Example usage:
results <- perform_linear_regression(weekly_data_x, data_fao,"Abbotsford", "week_Mean_Temperature")

unique_crops <- unique(data_fao$Item)
#Print results for each crop
for (crop in unique_crops) {
  print(paste("Results for crop:", crop))
  print(results[[crop]]$summary)
  if (!is.null(results[[crop]]$plot)) {
    print(results[[crop]]$plot)
  }
}

```
